
{% extends "base.html" %}

{% block title %} Visualizer {% endblock %}

{% block head %}
    {{ super() }}
{% endblock %}

{% block header %} Visualizer {% endblock %}

{% block content %}
{{ super() }}

<div class="col-lg-12">
    <div class="panel panel-default">
        <div class="panel-heading">Controls</div>
        <div class="panel-body">
            <label>Query</label>
            <div class="form-group input-group">
                <input class="form-control" type="text">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">
                        <i class="fa fa-bar-chart"></i>
                    </button>
                </span>
            </div>
        </div>  
    </div> 
</div>

<div class="col-lg-12">
    <div class="panel panel-default">
        <div class="panel-heading">Add Query</div>
        <div class="panel-body">
            <label>Query</label>
            <div class="form-group input-group">
                <input class="form-control" type="text">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button">
                        <i class="fa fa-bar-chart"></i>
                    </button>
                </span>
            </div>
        </div>  
    </div> 
</div>

{% endblock %}

{% block scripts %}

<script src="/static/packets.js"></script>

<script>

    function getDisplay(data, field)
    {
        var disp = data.decoded[field].cvalue;

        if (data.decoded[field].decimals !== null) {
            disp = disp.toFixed(data.decoded[field].decimals);
        }

        disp += data.decoded[field].unit
        return disp;
    }

    function receive(data)
    {
        decodePacket(data);
        var fields = Object.keys(data.decoded);

        if (($('tr[data-address="'+data.address+'"]').length) > 0)
        {

            for (var f in fields)
            {
                var field = fields[f];
                var disp = getDisplay(data, field);
                $('td[data-field="' + data.address + '-' + field + '"]').html(disp);
            }
        }
        else
        {
            for (var f in fields)
            {
                var field = fields[f];
                var row = $("<tr></tr>");

                if (f == 0)
                {
                    row.attr("data-address", data.address)
                    row.append($("<td></td>")
                                   .attr("rowspan", fields.length)
                                   .html(data.address));
                    row.append($("<td></td>")
                                   .attr("rowspan", fields.length)
                                   .html(data.board));
                    row.append($("<td></td>")
                                   .attr("rowspan", fields.length)
                                   .html(data.name));
                }

                row.append($("<td></td>").html(field));

                var disp = getDisplay(data, field);

                row.append($("<td></td>")
                                   .attr("data-field", data.address + '-' + field)
                                   .html(disp));

                $("#packet_table_body").append(row);
            }

        }
    }


</script>

{% endblock %}

{% block active_menu %}visualizer{% endblock %}
